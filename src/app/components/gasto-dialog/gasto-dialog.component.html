<div class="modal-overlay" (click)="onOverlayClick($event)">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">{{ esEdicion ? 'Editar' : 'Agregar' }} Gasto</h3>
      <button class="modal-close" (click)="cancelar()">×</button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="guardar()" #gastoForm="ngForm">
        <div class="form-group">
          <label for="descripcion" class="form-label">Descripción *</label>
          <input
            type="text"
            id="descripcion"
            name="descripcion"
            [(ngModel)]="gasto.descripcion"
            class="form-input"
            placeholder="Ej: Supermercado, Combustible"
            required
            #descripcion="ngModel"
          />
          <div class="form-error" *ngIf="descripcion.invalid && descripcion.touched">
            La descripción es requerida
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="tarjetaId" class="form-label">Tarjeta *</label>
            <select
              id="tarjetaId"
              name="tarjetaId"
              [(ngModel)]="gasto.tarjetaId"
              class="form-input"
              required
              #tarjetaId="ngModel"
            >
              <option value="" disabled>Selecciona una tarjeta</option>
              <option *ngFor="let t of tarjetas" [value]="t.id">{{ t.nombre }}</option>
            </select>
            <div class="form-error" *ngIf="tarjetaId.invalid && tarjetaId.touched">
              La tarjeta es requerida
            </div>
          </div>

          <div class="form-group">
            <label for="monto" class="form-label">Monto *</label>
            <input
              type="number"
              id="monto"
              name="monto"
              [(ngModel)]="gasto.monto"
              class="form-input"
              placeholder="0.00"
              min="0.01"
              step="0.01"
              required
              #monto="ngModel"
            />
            <div class="form-error" *ngIf="monto.invalid && monto.touched">
              El monto es requerido y debe ser mayor a 0
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="fecha" class="form-label">Fecha *</label>
          <input
            type="date"
            id="fecha"
            name="fecha"
            [(ngModel)]="gasto.fecha"
            (ngModelChange)="onFechaChange($event)"
            class="form-input"
            required
            #fecha="ngModel"
          />
          <div class="form-error" *ngIf="fecha.invalid && fecha.touched">
            La fecha es requerida
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="compartidoCon" class="form-label">Compartido con</label>
            <input
              type="text"
              id="compartidoCon"
              name="compartidoCon"
              [(ngModel)]="gasto.compartidoCon"
              class="form-input"
              placeholder="Nombre de la persona (opcional)"
            />
          </div>

          <div class="form-group">
            <label for="porcentajeCompartido" class="form-label">% Compartido</label>
            <input
              type="number"
              id="porcentajeCompartido"
              name="porcentajeCompartido"
              [(ngModel)]="gasto.porcentajeCompartido"
              class="form-input"
              min="0"
              max="100"
              step="1"
              [disabled]="!gasto.compartidoCon"
              placeholder="0-100"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="cantidadCuotas" class="form-label">Cantidad de cuotas</label>
            <input
              type="number"
              id="cantidadCuotas"
              name="cantidadCuotas"
              [(ngModel)]="gasto.cantidadCuotas"
              (ngModelChange)="onCantidadCuotasChange($event)"
              class="form-input"
              min="1"
              step="1"
              placeholder="1 = sin cuotas"
            />
          </div>

          <div class="form-group" *ngIf="esConCuotas">
            <label for="primerMesCuota" class="form-label">Primer mes (AAAA-MM)</label>
            <input
              type="month"
              id="primerMesCuota"
              name="primerMesCuota"
              [(ngModel)]="gasto.primerMesCuota"
              [required]="esConCuotas"
              class="form-input"
              placeholder="AAAA-MM"
            />
          </div>
        </div>

        
        
      </form>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-outline" (click)="cancelar()">
        Cancelar
      </button>
      <button
        type="button"
        class="btn btn-primary"
        (click)="guardar()"
        [disabled]="gastoForm.invalid"
      >
        {{ esEdicion ? 'Actualizar' : 'Agregar' }}
      </button>
    </div>
  </div>
</div>
